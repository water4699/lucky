# Lucky Dice 本地运行指南

## 快速启动

### 方式一：使用自动化脚本（推荐）

双击运行 `start-local-简化版.bat` 文件，脚本会自动：
1. 启动 Hardhat 本地节点
2. 部署合约
3. 启动前端开发服务器

稍等片刻后，在浏览器中打开 http://localhost:3000

### 方式二：手动启动

如果自动脚本有问题，可以手动分步操作：

#### 第 1 步：启动 Hardhat 节点

打开一个新的命令行窗口（终端 A）：

```bash
cd E:\Spring\Zama\lucky
npx hardhat node
```

保持此窗口运行，你会看到：
```
Started HTTP and WebSocket JSON-RPC server at http://127.0.0.1:8545/
...
Account #0: 0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266 (10000 ETH)
...
```

#### 第 2 步：部署合约

打开另一个命令行窗口（终端 B）：

```bash
cd E:\Spring\Zama\lucky
npx hardhat deploy --network localhost
```

看到类似输出表示成功：
```
deploying "LuckyDice"...
deployed at 0x... with XXX gas
LuckyDice contract: 0x...
```

#### 第 3 步：启动前端

在终端 B 中继续执行：

```bash
cd frontend
npm install
npm run dev
```

看到：
```
✓ Ready in Xms
○ Local: http://localhost:3000
```

#### 第 4 步：使用应用

1. 打开浏览器访问 http://localhost:3000
2. 点击右上角 "Connect Wallet" 连接 MetaMask
3. 在 MetaMask 中添加本地网络：
   - 网络名称：Hardhat Local
   - RPC URL：http://localhost:8545
   - 链 ID：31337
   - 货币符号：ETH
4. 导入测试账户（使用 Hardhat 默认账户的私钥）
5. 开始使用 Lucky Dice！

## 服务地址

- **Hardhat 节点**: http://localhost:8545
- **前端应用**: http://localhost:3000

## 测试账户

Hardhat 本地网络提供了 20 个预充值的测试账户，每个有 10000 ETH。

第一个账户（部署者）：
- 地址：`0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266`
- 私钥：`0xac0974bec39a17e36ba4a6b4d238ff944bacb478cbed5efcae784d7bf4f2ff80`

## 功能说明

### 投掷骰子
1. 输入 1-6 之间的数字
2. 点击"Submit Roll"提交加密的骰子值
3. 骰子值会被同态加密存储在链上

### 查看结果
1. 输入 Roll ID
2. 点击"Decrypt Roll"解密并查看：
   - 骰子点数
   - 累积总和
   - 是否中奖（总和 ≥ 18）

### 查看奖池
- 点击"Decrypt Pot"查看当前加密奖池的值

## 常见问题

### Q: 前端无法连接到合约？
**A**: 确保：
1. Hardhat 节点正在运行（终端 A）
2. 合约已成功部署
3. MetaMask 连接到正确的网络（localhost:8545, Chain ID 31337）

### Q: 交易失败？
**A**: 
1. 检查 MetaMask 是否有足够的 ETH
2. 重置 MetaMask 账户（设置 -> 高级 -> 重置账户）
3. 确保输入的值在有效范围内（1-6）

### Q: 看不到部署的合约？
**A**: 
1. 检查 `deployments/localhost/LuckyDice.json` 文件是否存在
2. 重新部署：`npx hardhat deploy --network localhost --reset`

### Q: 无法解密数据？
**A**: 
1. 确保使用的账户有权限查看该数据
2. 等待几秒让 ACL 更新生效
3. 刷新页面重试

## 停止服务

1. 在终端 A 按 `Ctrl+C` 停止 Hardhat 节点
2. 在终端 B 按 `Ctrl+C` 停止前端服务器
3. 关闭浏览器标签页

## 运行测试

```bash
# 本地测试
npx hardhat test

# Sepolia 测试网测试（需要配置）
npx hardhat test --network sepolia
```

## 项目结构

```
lucky/
├── contracts/          # Solidity 智能合约
│   └── LuckyDice.sol  # 主合约
├── deploy/            # 部署脚本
├── test/              # 测试文件
├── frontend/          # Next.js 前端应用
│   ├── app/          # 页面组件
│   ├── components/   # UI 组件
│   ├── hooks/        # React Hooks
│   └── fhevm/        # FHEVM SDK 集成
├── deployments/       # 部署信息
└── hardhat.config.ts  # Hardhat 配置

```

## 更多信息

- [FHEVM 文档](https://docs.zama.ai/fhevm)
- [Hardhat 文档](https://hardhat.org/docs)
- [项目 README](./README.md)

