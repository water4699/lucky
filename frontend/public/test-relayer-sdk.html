<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RelayerSDK Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #1a1a2e;
            color: #eee;
        }
        h1 { color: #7c3aed; }
        .status {
            padding: 15px;
            margin: 15px 0;
            border-radius: 8px;
            border: 1px solid #444;
        }
        .success { background: #10b98144; border-color: #10b981; }
        .error { background: #ef444444; border-color: #ef4444; }
        .info { background: #3b82f644; border-color: #3b82f6; }
        .loading { background: #f59e0b44; border-color: #f59e0b; }
        pre {
            background: #0d1117;
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
            color: #c9d1d9;
        }
        button {
            background: #7c3aed;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #6d28d9; }
        button:disabled {
            background: #444;
            cursor: not-allowed;
        }
    </style>
</head>
<body>
    <h1>üîç RelayerSDK Diagnostic Tool</h1>
    
    <div class="status info">
        <strong>Purpose:</strong> Test if Zama RelayerSDK can load properly for Sepolia testnet
    </div>

    <h2>Test Results</h2>
    
    <div id="status" class="status loading">
        <strong>Status:</strong> <span id="status-text">Initializing...</span>
    </div>

    <div id="details"></div>

    <h2>Actions</h2>
    <button onclick="loadSDK()">Load SDK</button>
    <button onclick="initSDK()" id="initBtn" disabled>Initialize SDK</button>
    <button onclick="checkWindow()">Check Window</button>
    <button onclick="location.reload()">Refresh</button>

    <h2>Logs</h2>
    <pre id="logs"></pre>

    <script>
        const SDK_URL = 'https://cdn.zama.ai/relayer-sdk-js/0.2.0/relayer-sdk-js.umd.cjs';
        let logs = [];

        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logMessage = `[${timestamp}] ${message}`;
            logs.push(logMessage);
            document.getElementById('logs').textContent = logs.join('\n');
            console.log(logMessage);
        }

        function updateStatus(text, className) {
            const statusDiv = document.getElementById('status');
            document.getElementById('status-text').textContent = text;
            statusDiv.className = `status ${className}`;
        }

        function showDetails(title, content) {
            const detailsDiv = document.getElementById('details');
            detailsDiv.innerHTML = `
                <h3>${title}</h3>
                <pre>${JSON.stringify(content, null, 2)}</pre>
            `;
        }

        function checkWindow() {
            log('Checking window object...');
            
            const checks = {
                hasWindow: typeof window !== 'undefined',
                hasRelayerSDK: 'relayerSDK' in window,
                relayerSDKType: typeof window.relayerSDK,
                hasInitSDK: window.relayerSDK?.initSDK !== undefined,
                hasCreateInstance: window.relayerSDK?.createInstance !== undefined,
                hasSepoliaConfig: window.relayerSDK?.SepoliaConfig !== undefined,
                isInitialized: window.relayerSDK?.__initialized__
            };

            log('Window check complete');
            showDetails('Window Object Check', checks);

            if (checks.hasRelayerSDK && checks.hasInitSDK) {
                updateStatus('RelayerSDK is available!', 'success');
                document.getElementById('initBtn').disabled = false;
            } else {
                updateStatus('RelayerSDK is NOT available', 'error');
            }

            return checks;
        }

        function loadSDK() {
            log('Starting SDK load...');
            updateStatus('Loading SDK...', 'loading');

            // Check if already loaded
            if ('relayerSDK' in window) {
                log('SDK already exists in window');
                checkWindow();
                return;
            }

            // Check if script already exists
            const existingScript = document.querySelector(`script[src="${SDK_URL}"]`);
            if (existingScript) {
                log('Script tag already exists');
                checkWindow();
                return;
            }

            log(`Loading SDK from: ${SDK_URL}`);
            
            const script = document.createElement('script');
            script.src = SDK_URL;
            script.type = 'text/javascript';
            script.async = true;

            script.onload = () => {
                log('‚úÖ Script loaded successfully!');
                updateStatus('SDK loaded successfully!', 'success');
                setTimeout(() => checkWindow(), 100);
            };

            script.onerror = (error) => {
                log(`‚ùå Script load failed: ${error}`);
                updateStatus('SDK load failed!', 'error');
                showDetails('Load Error', {
                    message: 'Failed to load SDK from CDN',
                    url: SDK_URL,
                    error: error.toString()
                });
            };

            log('Adding script to DOM...');
            document.head.appendChild(script);
        }

        async function initSDK() {
            if (!window.relayerSDK) {
                log('‚ùå RelayerSDK not found. Load it first!');
                updateStatus('RelayerSDK not loaded', 'error');
                return;
            }

            log('Initializing SDK...');
            updateStatus('Initializing SDK...', 'loading');

            try {
                const result = await window.relayerSDK.initSDK();
                log(`‚úÖ SDK initialized: ${result}`);
                updateStatus('SDK initialized successfully!', 'success');
                
                showDetails('Initialization Result', {
                    success: result,
                    SepoliaConfig: window.relayerSDK.SepoliaConfig
                });
            } catch (error) {
                log(`‚ùå SDK initialization failed: ${error.message}`);
                updateStatus('SDK initialization failed!', 'error');
                showDetails('Initialization Error', {
                    error: error.message,
                    stack: error.stack
                });
            }
        }

        // Auto-start
        window.addEventListener('load', () => {
            log('Page loaded');
            log('Environment: ' + navigator.userAgent);
            checkWindow();
            
            // Auto-load SDK after 1 second
            setTimeout(() => {
                if (!('relayerSDK' in window)) {
                    log('Auto-loading SDK...');
                    loadSDK();
                }
            }, 1000);
        });
    </script>
</body>
</html>

